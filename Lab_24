import pandas as pd
import numpy as np
from sklearn.feature_selection import VarianceThreshold
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split

# 1)
df = pd.read_csv(r"C:\Users\Jawad.A\Downloads\data_day24_selection.csv")

# 2)
selector = VarianceThreshold(threshold=0.0)
selector.fit(df)
df_var = df.iloc[:, selector.get_support()]

# 3)
corr_matrix = df_var.corr().abs()
upper = corr_matrix.where(np.triu(np.ones(corr_matrix.shape), k=1).astype(bool))
to_drop = [column for column in upper.columns if any(upper[column] > 0.9)]
df_final = df_var.drop(columns=to_drop)

# 4)
def get_acc(data):
    X = data.drop(columns=['target'])
    y = data['target']
    X_tr, X_te, y_tr, y_te = train_test_split(X, y, test_size=0.2, random_state=42)
    model = RandomForestClassifier(random_state=42).fit(X_tr, y_tr)
    return accuracy_score(y_te, model.predict(X_te))

print(f"Accuracy (Original): {get_acc(df):.2f}")
print(f"Accuracy (After Selection): {get_acc(df_final):.2f}")
print(f"Dropped to correlation: {to_drop}")
